<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketplace</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

    <div class="container my-4">
        <h1 class="text-center">Marketplace</h1>

        <!-- Add Product Form -->
        <div class="card mb-4">
            <div class="card-header">Add Product</div>
            <div class="card-body">
                <form id="addProductForm">
                    <div class="mb-3">
                        <label for="name" class="form-label">Product Name</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="price" class="form-label">Price</label>
                        <input type="number" class="form-control" id="price" name="price" required>
                    </div>
                    <div class="mb-3">
                        <label for="classification" class="form-label">Classification</label>
                        <input type="text" class="form-control" id="classification" name="classification" required>
                    </div>
                    <div class="mb-3">
                        <label for="picture" class="form-label">Product Image</label>
                        <input type="file" class="form-control" id="picture" name="picture" accept="image/*">
                    </div>
                    <button type="submit" class="btn btn-primary">Add Product</button>
                </form>
            </div>
        </div>

        <!-- Products List -->
        <div class="card mb-4">
            <div class="card-header">Products List</div>
            <div class="card-body">
                <ul id="productList" class="list-group">
                    <!-- Products will be injected here by JS -->
                </ul>
            </div>
        </div>

        <!-- Update Product Form -->
        <div class="card mb-4">
            <div class="card-header">Update Product</div>
            <div class="card-body">
                <form id="updateProductForm">
                    <div class="mb-3">
                        <label for="product_id" class="form-label">Product ID</label>
                        <input type="number" class="form-control" id="product_id" name="product_id" required>
                    </div>
                    <div class="mb-3">
                        <label for="new_name" class="form-label">New Product Name</label>
                        <input type="text" class="form-control" id="new_name" name="new_name">
                    </div>
                    <div class="mb-3">
                        <label for="new_price" class="form-label">New Price</label>
                        <input type="number" class="form-control" id="new_price" name="new_price">
                    </div>
                    <div class="mb-3">
                        <label for="new_classification" class="form-label">New Classification</label>
                        <input type="text" class="form-control" id="new_classification" name="new_classification">
                    </div>
                    <div class="mb-3">
                        <label for="new_picture" class="form-label">New Product Image</label>
                        <input type="file" class="form-control" id="new_picture" name="new_picture" accept="image/*">
                    </div>
                    <button type="submit" class="btn btn-primary">Update Product</button>
                </form>
            </div>
        </div>

        <!-- Delete Product Form -->
        <div class="card mb-4">
            <div class="card-header">Delete Product</div>
            <div class="card-body">
                <form id="deleteProductForm">
                    <div class="mb-3">
                        <label for="del_product_id" class="form-label">Product ID</label>
                        <input type="number" class="form-control" id="del_product_id" name="del_product_id" required>
                    </div>
                    <button type="submit" class="btn btn-danger">Delete Product</button>
                </form>
            </div>
        </div>

        <!-- View Cart -->
        <div class="card mb-4">
            <div class="card-header">Cart</div>
            <div class="card-body">
                <ul id="cartItems" class="list-group">
                    <!-- Cart items will be injected here by JS -->
                </ul>
            </div>
        </div>
    </div>

    <!-- JS for handling API requests -->
    <script>
        // Handle Add Product
        document.getElementById('addProductForm').addEventListener('submit', function(e) {
            e.preventDefault();

            let formData = new FormData(this);
            fetch('/product/add', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                fetchProducts();  // Refresh product list after adding
                this.reset();
            })
            .catch(error => console.error('Error:', error));
        });

        // Handle Update Product
        document.getElementById('updateProductForm').addEventListener('submit', function(e) {
            e.preventDefault();

            let productId = document.getElementById('product_id').value;
            let formData = new FormData(this);

            fetch(`/product/update/${productId}`, {
                method: 'PUT',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                fetchProducts();  // Refresh product list after updating
                this.reset();
            })
            .catch(error => console.error('Error:', error));
        });

        // Handle Delete Product
        document.getElementById('deleteProductForm').addEventListener('submit', function(e) {
            e.preventDefault();

            let productId = document.getElementById('del_product_id').value;

            fetch(`/product/delete/${productId}`, {
                method: 'DELETE',
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                fetchProducts();  // Refresh product list after deletion
            })
            .catch(error => console.error('Error:', error));
        });

        // Fetch and display products
        function fetchProducts() {
            fetch('/products')
            .then(response => response.json())
            .then(data => {
                let productList = document.getElementById('productList');
                productList.innerHTML = '';  // Clear the current list
                data.forEach(product => {
                    let li = document.createElement('li');
                    li.className = 'list-group-item';
                    li.innerHTML = `ID: ${product.id} | Name: ${product.name} | Price: $${product.price} | Classification: ${product.classification}`;
                    productList.appendChild(li);
                });
            })
            .catch(error => console.error('Error:', error));
        }

        // Load Products on page load
        window.onload = function() {
            fetchProducts();
        }
    </script>

</body>
</html>
